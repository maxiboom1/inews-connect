/*! For license information please see app.bundle.cjs.LICENSE.txt */
(()=>{"use strict";var t,e,r,n,o={582:t=>{t.exports=require("cors")},860:t=>{t.exports=require("express")},147:t=>{t.exports=require("fs")},17:t=>{t.exports=require("path")},450:(t,e,r)=>{r.a(t,(async(t,n)=>{try{r.r(e);var o=r(811),i=r(380),a=r(860),c=r(582),u=r(639),s=t([o]);o=(s.then?(await s)():s)[0];var f=a();f.use(c()),f.use(a.json()),f.use("/api",i.Z),f.use(a.static("plugin"));var l=process.env.PORT||3e3;f.listen(l,(function(){var t=(0,u.Z)();console.log("Server service running on port ".concat(l)),console.log("Plugin url: http://".concat(t,":").concat(l,"/index.html")),o.Z.startMainProcess()})),n()}catch(t){n(t)}}))},208:(t,e,r)=>{r.d(e,{Z:()=>V});const n=require("events"),o=require("bluebird"),i=require("ftp");function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function c(){c=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",f=i.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var i=e&&e.prototype instanceof w?e:w,a=Object.create(i.prototype),c=new C(n||[]);return o(a,"_invoke",{value:j(t,r,c)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var y="suspendedStart",d="suspendedYield",v="executing",m="completed",g={};function w(){}function b(){}function x(){}var E={};l(E,u,(function(){return this}));var L=Object.getPrototypeOf,_=L&&L(L(N([])));_&&_!==r&&n.call(_,u)&&(E=_);var k=x.prototype=w.prototype=Object.create(E);function O(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,c,u){var s=p(t[o],t,i);if("throw"!==s.type){var f=s.arg,l=f.value;return l&&"object"==a(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,c,u)}),(function(t){r("throw",t,c,u)})):e.resolve(l).then((function(t){f.value=t,c(f)}),(function(t){return r("throw",t,c,u)}))}u(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function j(e,r,n){var o=y;return function(i,a){if(o===v)throw new Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=P(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===y)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var s=p(e,r,n);if("normal"===s.type){if(o=n.done?m:d,s.arg===g)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=m,n.method="throw",n.arg=s.arg)}}}function P(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[u];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(a(e)+" is not iterable")}return b.prototype=x,o(k,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:b,configurable:!0}),b.displayName=l(x,f,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,l(t,f,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},O(S.prototype),l(S.prototype,s,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(k),l(k,f,"Generator"),l(k,u,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function u(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function s(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){u(i,n,o,a,c,"next",t)}function c(t){u(i,n,o,a,c,"throw",t)}a(void 0)}))}}function f(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,l(n.key),n)}}function l(t){var e=function(t,e){if("object"!=a(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==a(e)?e:String(e)}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}function p(t){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},p(t)}const y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}(d,t);var e,r,n,i,u,l,y=(u=d,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=p(u);if(l){var r=p(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function d(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d),t=y.call(this),o.config({cancellation:!0}),t.queued=new Set,t.running=new Set;var e=0,r=0,n=0,i=function(){t.queued.size!==e&&(e=t.queued.size,t.emit("queued",e)),t.running.size!==r&&(r=t.running.size,t.emit("running",r)),t.running.size+t.queued.size!==n&&(n=t.running.size+t.queued.size,t.emit("requests",n)),t.startNext()};return t.on("start",i),t.on("end",i),t.on("enqueue",i),t.on("cancel",i),t}return e=d,r=[{key:"startNext",value:(i=s(c().mark((function t(){var e;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.queued.size>0)){t.next=22;break}if("function"==typeof(e=this.queued.entries().next().value[0]).config.startFilter&&!e.config.startFilter()){t.next=22;break}return this.queued.delete(e),this.running.add(e),t.prev=5,this.emit("start",e),e.attempts=this.attemptJobWithRetries(e),t.t0=e,t.next=11,e.attempts;case 11:t.t1=t.sent,t.t0.resolve.call(t.t0,t.t1),t.next=18;break;case 15:t.prev=15,t.t2=t.catch(5),e.reject(t.t2);case 18:return t.prev=18,this.running.delete(e),this.emit("end",e),t.finish(18);case 22:case"end":return t.stop()}}),t,this,[[5,15,18,22]])}))),function(){return i.apply(this,arguments)})},{key:"attemptJobWithRetries",value:function(t){var e=this;return this.attemptJobOnce(t).catch((function(r){if("function"==typeof t.config.retryFilter&&t.config.retryFilter(r))return e.attemptJobWithRetries(t);throw r}))}},{key:"attemptJobOnce",value:function(t){var e=this;return new o(function(){var r=s(c().mark((function r(n,i,a){var u,s;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:try{(u=t.config.start())instanceof o?(s="number"==typeof t.config.timeout&&t.config.timeout>0?setTimeout((function(){i(new Error("timeout"))}),t.config.timeout):null,a((function(){if("function"==typeof u.cancel)try{u.cancel()}catch(t){e.emit("error",t)}})),u.then(n).catch(i).finally((function(){null!==s&&clearTimeout(s)}))):n(u)}catch(t){i(t)}case 1:case"end":return r.stop()}}),r)})));return function(t,e,n){return r.apply(this,arguments)}}())}},{key:"enqueue",value:function(t){var e=this;return new o((function(r,n,o){var i={config:t,resolve:r,reject:n};e.queued.add(i),e.emit("enqueue",i),o((function(){e.queued.has(i)?(e.queued.delete(i),e.emit("cancel",i)):e.running.has(i)&&(i.attempts.cancel(),e.running.delete(i))}))}))}},{key:"destroy",value:(n=s(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.removeAllListeners();case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})}],r&&f(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),d}(n),d=require("camelcase"),v=require("unescape"),m=require("htmlparser2"),g=function(t){var e,r=[],n=[],o=new m.Parser({onopentag:function(t,o){e={type:"tag",name:t,attributes:o,children:[]},0===n.length?r.push(e):n[n.length-1].children.push(e),n.push(e)},ontext:function(t){t.trim().length&&e.children.push({type:"text",text:t})},onclosetag:function(t){n.pop()}},{decodeEntities:!0,xmlMode:!0});return o.write(t),o.end(),r};function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}function b(){b=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new C(n||[]);return o(a,"_invoke",{value:j(t,r,c)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var h="suspendedStart",p="suspendedYield",y="executing",d="completed",v={};function m(){}function g(){}function x(){}var E={};s(E,a,(function(){return this}));var L=Object.getPrototypeOf,_=L&&L(L(N([])));_&&_!==r&&n.call(_,a)&&(E=_);var k=x.prototype=m.prototype=Object.create(E);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var u=l(t[o],t,i);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==w(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(f).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function j(e,r,n){var o=h;return function(i,a){if(o===y)throw new Error("Generator is already running");if(o===d){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=P(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var s=l(e,r,n);if("normal"===s.type){if(o=n.done?d:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=d,n.method="throw",n.arg=s.arg)}}}function P(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=l(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(w(e)+" is not iterable")}return g.prototype=x,o(k,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:g,configurable:!0}),g.displayName=s(x,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,s(t,u,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},O(S.prototype),s(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(f(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(k),s(k,u,"Generator"),s(k,a,(function(){return this})),s(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function x(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return E(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function E(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function L(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}const _=function(){var t,e=(t=b().mark((function t(e){var r,n,o,i,a,c,u;return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=function(t){var e="";for(var r in t)t.hasOwnProperty(r)&&(e.length>0&&(e+=" "),e+="".concat(r,'="').concat(t[r].replace(/\"/g,'\\"'),'"'));return e},c=function(t){switch(t.type){case"tag":var e="<".concat(t.name),r=u(t.attributes);return r.length>0&&(e+=" ".concat(r)),e+">".concat(a(t.children),"</").concat(t.name,">");case"text":return t.text}},a=function(t){var e="";return Array.isArray(t)&&t.forEach((function(t){e+=c(t)})),e},i=function(t,e){var r=[];return t.forEach((function(t,n){"tag"===t.type&&(t.name===e&&r.push(a(t.children)),r=r.concat(i(t.children,e)))})),r},o=function(t){var e,n=x(t);try{for(n.s();!(e=n.n()).done;){var c=e.value;switch(c.name){case"wgroup":r.wgroup=c.attributes.number;break;case"rgroup":r.rgroup=c.attributes.number;break;case"ae":try{var u=c.attributes.id;r.cues[u]=i(c.children,"ap")}catch(t){}break;case"body":r.body=v(a(c.children));break;case"meta":r.meta=c.attributes,o(c.children);break;case"storyid":try{r.id=v(a(c.children))}catch(t){}break;case"formname":try{r.formname=v(a(c.children))}catch(t){}break;case"f":try{r.fields[d(c.attributes.id)]=v(a(c.children))}catch(t){}break;case"attachment":try{r.attachments[d(c.attributes.id)]=v(a(c.children))}catch(t){}break;default:"tag"===c.type&&o(c.children)}}}catch(t){n.e(t)}finally{n.f()}},r={fields:{},meta:{},cues:[],attachments:{}},n=g(e),o(n),t.abrupt("return",r);case 9:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){L(i,n,o,a,c,"next",t)}function c(t){L(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t){return e.apply(this,arguments)}}();function k(t){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k(t)}function O(){O=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new C(n||[]);return o(a,"_invoke",{value:j(t,r,c)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var h="suspendedStart",p="suspendedYield",y="executing",d="completed",v={};function m(){}function g(){}function w(){}var b={};s(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function _(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var u=l(t[o],t,i);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==k(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(f).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function j(e,r,n){var o=h;return function(i,a){if(o===y)throw new Error("Generator is already running");if(o===d){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=P(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var s=l(e,r,n);if("normal"===s.type){if(o=n.done?d:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=d,n.method="throw",n.arg=s.arg)}}}function P(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=l(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(k(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=s(w,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},_(S.prototype),s(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(f(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function S(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return j(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?j(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function P(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,T(n.key),n)}}function T(t){var e=function(t,e){if("object"!=k(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=k(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==k(e)?e:String(e)}const I=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._root=new Map}var r,n;return r=e,n=[{key:Symbol.iterator,value:O().mark((function t(){var e;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return O().mark((function n(){var o,i,a,c;return O().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=S(t),n.prev=1,o.s();case 3:if((i=o.n()).done){n.next=14;break}if(a=i.value,c=a[0],!(a[1]instanceof Map)){n.next=10;break}return n.delegateYield(e(t.get(c),r.concat([c])),"t0",8);case 8:n.next=12;break;case 10:return n.next=12,[r.concat([c]),t.get(c)];case 12:n.next=3;break;case 14:n.next=19;break;case 16:n.prev=16,n.t1=n.catch(1),o.e(n.t1);case 19:return n.prev=19,o.f(),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[1,16,19,22]])}))()},t.delegateYield(e(this._root),"t0",2);case 2:case"end":return t.stop()}}),t,this)}))},{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return function t(e,r,n){var o=Array.isArray(r)?r:r.split(".");return e instanceof Map?1===o.length?e.has(o[0])?e.get(o[0]):n:t(e.get(o[0]),o.slice(1),n):n}(this._root,t,e)}},{key:"set",value:function(t,e){return function t(e,r,n){var o=Array.isArray(r)?r:r.split("."),i=o[0];1===o.length?e.set(i,n):(e.get(i)instanceof Map||e.set(i,new Map),t(e.get(i),o.slice(1),n))}(this._root,t,e)}},{key:"has",value:function(t){return function t(e,r){var n=Array.isArray(r)?r:r.split(".");return e instanceof Map&&(1===n.length?e.has(n[0]):t(e.get(n[0]),n.slice(1)))}(this._root,t)}},{key:"delete",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function t(e,r,n){var o=Array.isArray(r)?r:r.split("."),i=o[0];1===o.length?e.delete(i):e.get(i)instanceof Map&&(t(e.get(i),o.slice(1)),n&&0===e.get(i).size&&e.delete(i))}(this._root,t,e)}}],n&&P(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),e}();var C=r(316);function N(){N=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new T(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var h="suspendedStart",p="suspendedYield",y="executing",d="completed",v={};function m(){}function g(){}function w(){}var b={};s(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function _(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=l(t[o],t,i);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==G(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(f).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===y)throw new Error("Generator is already running");if(o===d){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=S(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var s=l(e,r,n);if("normal"===s.type){if(o=n.done?d:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=d,n.method="throw",n.arg=s.arg)}}}function S(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,S(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=l(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(G(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=s(w,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},_(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(f(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function A(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function F(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){A(i,n,o,a,c,"next",t)}function c(t){A(i,n,o,a,c,"throw",t)}a(void 0)}))}}function G(t){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G(t)}function R(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,q(n.key),n)}}function q(t){var e=function(t,e){if("object"!=G(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=G(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==G(e)?e:String(e)}function D(t,e){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},D(t,e)}function Z(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function M(t){return M=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},M(t)}o.config({cancellation:!0});const U=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&D(t,e)}(f,t);var e,r,n,a,c,u,s=(c=f,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=M(c);if(u){var r=M(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===G(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Z(t)}(this,t)});function f(t){var e,r=arguments;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f),(e=s.call(this))._pendingPromises=new I,e.config=Object.assign({timeout:6e4,reconnectTimeout:5e3,maxRunning:5e3,maxAttempts:5,maxReconnectAttempts:null,debug:!1,rootDir:""},t),e.status="disconnected",Array.isArray(e.config.hosts)||"string"!=typeof e.config.host||(e.config.hosts=[e.config.host]),!Array.isArray(e.config.hosts)||0===e.config.hosts.length)throw new Error("Missing hosts option");if(!e.config.hasOwnProperty("user"))throw new Error("Missing user option");if(!e.config.hasOwnProperty("password"))throw new Error("Missing password option");return e._ftpConn=new i,new Map([["ready","connected"],["error","error"],["close","disconnected"],["end","disconnected"]]).forEach((function(t,n){e._ftpConn.on(n,(function(){e.status=t,e.emit.apply(Z(e),[n].concat(Array.prototype.slice.call(r)))}))})),e.on("disconnected",(function(){e._currentDir=null})),e._jobsQueue=new y,e._jobsQueue.on("queued",(function(t){e.emit("queued",t)})),e._jobsQueue.on("running",(function(t){e.emit("running",t)})),e._jobsQueue.on("requests",(function(t){e.emit("requests",t)})),e._jobsQueue.on("error",(function(t){e.emit("error",t)})),e.on("error",(function(t){e._debug(t)})),e}return e=f,r=[{key:"lastDirectory",get:function(){return this._lastDirectory}},{key:"connected",get:function(){return null!==this._ftpConn&&this._ftpConn.connected}},{key:"queued",get:function(){return this._jobsQueue.queued.size}},{key:"running",get:function(){return this._jobsQueue.running.size}},{key:"requests",get:function(){return this.queued+this.running}},{key:"status",get:function(){return this._status},set:function(t){t!==this._status&&(this._status=t,this.emit("status",t))}},{key:"host",get:function(){return this.hasOwnProperty("_ftpConnConfig")&&"object"===G(this._ftpConnConfig)?this._ftpConnConfig.host:void 0}},{key:"connect",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=function(t){return new o((function(e){setTimeout((function(){e()}),t)}))},n=function(e){return t.status="connecting",new o((function(r,n){var i=!1,a=function(){i||(i=!0,new o((function(e,r){console.log(C.Z.ftpSiteFormat),t._ftpConn.site("FORMAT=".concat(C.Z.ftpSiteFormat),(function(t,n){t?r(t):e(n)}))})).then((function(){t._currentDir=null,u(),r(t._ftpConn)})).catch((function(t){u(),n(t)})))},c=function(t){i||(i=!0,u(),n(t))},u=function(){t._ftpConn.removeListener("ready",a),t._ftpConn.removeListener("error",c)};t._ftpConn.once("ready",a),t._ftpConn.once("error",c),t._ftpConn.connect(e)}))};return new o(function(){var o=F(N().mark((function o(i,a){var c;return N().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if("connected"!==t.status||e){o.next=4;break}i(t._ftpConn),o.next=34;break;case 4:if(void 0!==t._connectionInProgress&&t._connectionInProgress){o.next=34;break}t._connectionInProgress=!0,t._currentDir=null,c=0;case 8:if(!("number"!=typeof t.config.maxReconnectAttempts||t.config.maxReconnectAttempts<0||c<t.config.maxReconnectAttempts)){o.next=32;break}if(!(e||c>0)){o.next=12;break}return o.next=12,t.disconnect();case 12:if(t._ftpConnConfig={host:t.config.hosts[c%t.config.hosts.length],user:t.config.user,password:t.config.password},t._debug("Connecting to",t._ftpConnConfig.host),!(c>0&&"number"==typeof t.config.reconnectTimeout&&t.config.reconnectTimeout>0)){o.next=17;break}return o.next=17,r(t.config.reconnectTimeout);case 17:return o.prev=17,o.next=20,n(t._ftpConnConfig);case 20:return t._debug("Connected to",t._ftpConnConfig.host),delete t._connectionInProgress,i(t._ftpConn),o.abrupt("return");case 26:o.prev=26,o.t0=o.catch(17),t.emit("error",o.t0);case 29:c++,o.next=8;break;case 32:t.emit("error","max_reconnect_attempts"),a("max_reconnect_attempts");case 34:case"end":return o.stop()}}),o,null,[[17,26]])})));return function(t,e){return o.apply(this,arguments)}}())}},{key:"disconnect",value:function(){var t=this;return new o((function(e,r){t._ftpConn.connected?(t.once("end",(function(){e()})),t._ftpConn.end()):e()}))}},{key:"destroy",value:(a=F(N().mark((function t(){return N().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.disconnect();case 2:return t.next=4,this._jobsQueue.destroy();case 4:this.removeAllListeners();case 5:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"story",value:function(t,e){return this.storyNsml(t,e).then((function(t){return _(t)}))}},{key:"storyNsml",value:function(t,e){var r=this,n=["storyNsml",t,e];if(this._pendingPromises.has(n))return this._pendingPromises.get(n);this._lastDirectory=t;var o=0,i=this._jobsQueue.enqueue({start:function(){return r.connect().then((function(){return r._cwd(t)})).then((function(){return r._get(e)}))},startFilter:function(){return r.canStartNextJob(t)},retryFilter:function(t){return++o<r.config.maxAttempts&&"cwd_failed"!==t.message&&!t.message.includes("no such story")&&!t.message.includes("invalid story identifier")},timeout:this.config.timeout}).finally((function(){r._pendingPromises.delete(n)}));return this._pendingPromises.set(n,i),i}},{key:"list",value:function(t){var e=this,r=["list",t];if(this._pendingPromises.has(r))return this._pendingPromises.get(r);this._lastDirectory=t;var n=0,i=this._jobsQueue.enqueue({start:function(){return e.connect().then((function(){return e._cwd(t)})).then((function(){return new o((function(t,r){e._ftpConn.list((function(e,n){if(e)r(e);else{var o=[];Array.isArray(n)&&n.forEach((function(t){var e=f.fileFromListItem(t);void 0!==e&&o.push(e)})),t(o)}}))}))}))},startFilter:function(){return e.canStartNextJob(t)},retryFilter:function(t){return++n<e.config.maxAttempts&&!t.message.includes("No such directory")},timeout:this.config.timeout}).finally((function(){e._pendingPromises.delete(r)}));return this._pendingPromises.set(r,i),i}},{key:"canStartNextJob",value:function(t){return 0===this.running||(this._currentDir===t&&"string"!=typeof this._requestedDir||this._requestedDir===t||"string"!=typeof this._currentDir&&"string"!=typeof this._requestedDir)&&"connected"===this.status&&this.running<this.config.maxRunning}},{key:"_cwd",value:function(t){var e=this;return t===this._currentDir?new o((function(t,r){t(e._currentDir)})):t===this._requestedDir?this._cwdPromise:void 0!==this._requestedDir?new o((function(t,e){e("cwd_in_progress")})):(this._requestedDir=t,this._cwdPromise=new o((function(r,n){e._ftpConn.cwd(t,(function(t,o){delete e._requestedDir,t?(e._currentDir=null,e.emit("error",t),n(t)):(e._currentDir=o,r(o)),e.emit("cwd",e._currentDir)}))})),this._cwdPromise)}},{key:"_get",value:function(t){var e=this;return new o((function(r,n,o){e._ftpConn.get(t,(function(t,i){if(e.emit("stream"),o((function(){try{i.destroy()}catch(t){e.emit("error",t)}})),t)n(t);else if(i){var a="";i.setEncoding("utf8"),i.on("error",(function(){n("stream_error")})),i.on("data",(function(t){a+=t})),i.once("close",(function(){r(a)}))}else n("no_stream")}))}))}},{key:"_debug",value:function(){this.config.debug&&console.log.apply(console,[(new Date).toISOString()].concat(Array.prototype.slice.call(arguments)))}}],n=[{key:"listItemIsQueue",value:function(t){return 0===t.indexOf("d---------")}},{key:"listItemIsFile",value:function(t){return void 0!==f.filenameFromListItem(t)}},{key:"fileFromListItem",value:function(t){var e=null;if(f.listItemIsFile(t)){var r=f.filenameFromListItem(t);(e=void 0!==r?{fileType:f.FILETYPES.STORY,fileName:r}:{}).identifier=f.storyIdentifierFromFilename(r),e.locator=f.storyLocatorFromFilename(r),e.storyName=f.storyNameFromListItem(t)}else if(f.listItemIsQueue(t)){var n=f.queueFromListItem(t);void 0!==n&&(e={fileType:f.FILETYPES.DIRECTORY,fileName:n})}if(null!==e){var o=f.dateFromListItem(t);return void 0!==o&&(e.modified=o),e.flags=f.flagsFromListItem(t),e}}},{key:"storyIdentifierFromFilename",value:function(t){return t.split(":")[0].toUpperCase()}},{key:"storyLocatorFromFilename",value:function(t){var e=t.split(":");return"".concat(e[1],":").concat(e[2]).toUpperCase()}},{key:"flagsFromListItem",value:function(t){var e={},r=t.match(/([^\s]+)/i);return e.floated="f"===r[0][1],e}},{key:"dateFromListItem",value:function(t){var e=t.match(/ ([A-Za-z]{3,4})[ ]+([0-9]{1,2})[ ]+([0-9]{4}|([0-9]{1,2}):([0-9]{2}))/i);try{if(void 0!==e[4]){var r=new Date,n=new Date(e[1]+" "+e[2]+" "+r.getFullYear()+" "+e[3]);return n.getMonth()>r.getMonth()&&n.setFullYear(r.getFullYear()-1),n}return new Date(e[0])}catch(t){return}}},{key:"queueFromListItem",value:function(t){var e=t.match(/.([A-Za-z0-9\-]*)$/);return null===e?void 0:e[1]}},{key:"filenameFromListItem",value:function(t){var e=t.match(/[A-Z0-9]{8}:[A-Z0-9]{8}:[A-Z0-9]{8}/i);return null===e?void 0:e[0]}},{key:"storyNameFromListItem",value:function(t){var e=t.match(/(?:[0-9A-F]{8}:?){3} (.+?)$/);return Array.isArray(e)&&e.length>1?e[1]:null}},{key:"FILETYPES",get:function(){return Object.freeze({STORY:"STORY",DIRECTORY:"DIRECTORY"})}}],r&&R(e.prototype,r),n&&R(e,n),Object.defineProperty(e,"prototype",{writable:!1}),f}(n);function Y(t){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(t)}function z(){z=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new T(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var h="suspendedStart",p="suspendedYield",y="executing",d="completed",v={};function m(){}function g(){}function w(){}var b={};s(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function _(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=l(t[o],t,i);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==Y(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(f).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===y)throw new Error("Generator is already running");if(o===d){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=S(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var s=l(e,r,n);if("normal"===s.type){if(o=n.done?d:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=d,n.method="throw",n.arg=s.arg)}}}function S(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,S(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=l(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Y(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=s(w,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},_(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(f(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function J(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Q(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return B(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?B(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function B(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function W(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,X(n.key),n)}}function X(t){var e=function(t,e){if("object"!=Y(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Y(e)?e:String(e)}function H(t,e){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},H(t,e)}function $(t){return $=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$(t)}const V=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&H(t,e)}(s,t);var e,r,n,o,i,a,c,u=(a=s,c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$(a);if(c){var r=$(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Y(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(t=u.call(this))._connectionClients=new Set,t._connectionClientTimeouts=new Map,t._pendingRequestConnectionClients=new I,t.config=Object.assign({maxConnections:1,minConnections:0,optimalConnectionJobs:25,rotateHosts:!0,connectionIdleTimeout:6e4,debug:!1},e),"number"!=typeof t.config.maxConnections||t.config.maxConnections<1)throw new Error("maxConnections must be larger than 1");if(t.config.maxConnections<t.config.minConnections)throw new Error("minConnections must be greater than or equal to maxConnections");if(Array.isArray(t.config.hosts)||"string"!=typeof t.config.host||(t.config.hosts=[t.config.host]),!Array.isArray(t.config.hosts)||0===t.config.hosts.length)throw new Error("Missing hosts option");if(!t.config.hasOwnProperty("user"))throw new Error("Missing user option");if(!t.config.hasOwnProperty("password"))throw new Error("Missing password option");return t}return e=s,r=[{key:"connections",get:function(){return this._connectionClients.size}},{key:"load",get:function(){return this.requests/(this.config.maxConnections*this.config.optimalConnectionJobs)}},{key:"requests",get:function(){var t,e=0,r=Q(this._connectionClients);try{for(r.s();!(t=r.n()).done;)e+=t.value.requests}catch(t){r.e(t)}finally{r.f()}return e}},{key:"queued",get:function(){var t,e=0,r=Q(this._connectionClients);try{for(r.s();!(t=r.n()).done;)e+=t.value.queued}catch(t){r.e(t)}finally{r.f()}return e}},{key:"running",get:function(){var t,e=0,r=Q(this._connectionClients);try{for(r.s();!(t=r.n()).done;)e+=t.value.running}catch(t){r.e(t)}finally{r.f()}return e}},{key:"list",value:function(t){var e=this,r=["list",t];if(this._pendingRequestConnectionClients.has(r))return this._pendingRequestConnectionClients.get(r).list(t);var n=this._optimalConnectionClient(t);this._pendingRequestConnectionClients.set(r,n);var o=""===t?"/":t;return n.list(o).finally((function(){e._pendingRequestConnectionClients.delete(r)}))}},{key:"story",value:function(t,e){var r=this,n=["story",t,e];if(this._pendingRequestConnectionClients.has(n))return this._pendingRequestConnectionClients.get(n).story(t,e);var o=this._optimalConnectionClient(t);return this._pendingRequestConnectionClients.set(n,o),o.story(t,e).finally((function(){r._pendingRequestConnectionClients.delete(n)}))}},{key:"storyNsml",value:function(t,e){var r=this,n=["story",t,e];if(this._pendingRequestConnectionClients.has(n))return this._pendingRequestConnectionClients.get(n).storyNsml(t,e);var o=this._optimalConnectionClient(t);return this._pendingRequestConnectionClients.set(n,o),o.storyNsml(t,e).finally((function(){r._pendingRequestConnectionClients.delete(n)}))}},{key:"_optimalConnectionClient",value:function(t){var e=Array.from(this._connectionClients);e.sort((function(t,e){return t.requests>e.requests?-1:t.requests<e.requests?1:0}));for(var r=0,n=e;r<n.length;r++){var o=n[r];if(o.lastDirectory===t&&o.requests<this.config.optimalConnectionJobs)return o}for(var i=0,a=e;i<a.length;i++){var c=a[i];if(c.requests<this.config.optimalConnectionJobs)return c}if(this.connections<this.config.maxConnections)return this._addConnectionClient();for(var u=this.load,s=0,f=e;s<f.length;s++){var l=f[s],h=l.requests/this.config.optimalConnectionJobs;if(l.lastDirectory===t&&Math.floor(h)<=Math.floor(u))return l}return e[e.length-1]}},{key:"_addConnectionClient",value:function(){var t=this,e=this.config.hosts;if(this.config.rotateHosts){var r="number"==typeof this._hostStartIndex?(this._hostStartIndex+1)%e.length:0;e=e.slice(r).concat(e.slice(0,r)),this._hostStartIndex=r}var n=new U(Object.assign({},this.config,{hosts:e}));return n.on("error",(function(e){t.emit("error",e)})),n.on("queued",(function(e){t.emit("queued",t.queued)})),n.on("running",(function(e){t.emit("running",t.running)})),n.on("requests",(function(e){t.emit("requests",t.requests),e>0?t._deleteConnectionClientTimeout(n):t._resetConnectionClientTimeout(n)})),this._connectionClients.add(n),this.emit("connections",this.connections),n}},{key:"_deleteConnectionClient",value:(o=z().mark((function t(e){return z().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this._connectionClients.has(e)&&this.connections-1>=this.config.minConnections)){t.next=6;break}return this._connectionClients.delete(e),t.next=4,e.destroy();case 4:this.emit("connections",this.connections),this._debug("Deleting connectionClient");case 6:case"end":return t.stop()}}),t,this)})),i=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=o.apply(t,e);function a(t){J(i,r,n,a,c,"next",t)}function c(t){J(i,r,n,a,c,"throw",t)}a(void 0)}))},function(t){return i.apply(this,arguments)})},{key:"_deleteConnectionClientTimeout",value:function(t){this._connectionClientTimeouts.has(t)&&(clearTimeout(this._connectionClientTimeouts.get(t)),this._connectionClientTimeouts.delete(t))}},{key:"_resetConnectionClientTimeout",value:function(t){var e=this;if(this._deleteConnectionClientTimeout(t),"number"==typeof this.config.connectionIdleTimeout&&this.config.connectionIdleTimeout>0){var r=setTimeout((function(){e._deleteConnectionClient(t)}),this.config.connectionIdleTimeout);this._connectionClientTimeouts.set(t,r)}}},{key:"_debug",value:function(){this.config.debug&&console.log.apply(console,[(new Date).toISOString()].concat(Array.prototype.slice.call(arguments)))}}],n=[{key:"FILETYPES",get:function(){return U.FILETYPES}}],r&&W(e.prototype,r),n&&W(e,n),Object.defineProperty(e,"prototype",{writable:!1}),s}(n)},153:(t,e,r)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function c(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach((function(e){var n,o,i;n=t,o=e,i=r[e],(o=h(o))in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function u(){u=function(){return e};var t,e={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",f=a.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var o=e&&e.prototype instanceof w?e:w,a=Object.create(o.prototype),c=new C(n||[]);return i(a,"_invoke",{value:j(t,r,c)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var y="suspendedStart",d="suspendedYield",v="executing",m="completed",g={};function w(){}function b(){}function x(){}var E={};l(E,c,(function(){return this}));var L=Object.getPrototypeOf,_=L&&L(L(N([])));_&&_!==r&&o.call(_,c)&&(E=_);var k=x.prototype=w.prototype=Object.create(E);function O(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(i,a,c,u){var s=p(t[i],t,a);if("throw"!==s.type){var f=s.arg,l=f.value;return l&&"object"==n(l)&&o.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,c,u)}),(function(t){r("throw",t,c,u)})):e.resolve(l).then((function(t){f.value=t,c(f)}),(function(t){return r("throw",t,c,u)}))}u(s.arg)}var a;i(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function j(e,r,n){var o=y;return function(i,a){if(o===v)throw new Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=P(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===y)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var s=p(e,r,n);if("normal"===s.type){if(o=n.done?m:d,s.arg===g)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=m,n.method="throw",n.arg=s.arg)}}}function P(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[c];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function r(){for(;++i<e.length;)if(o.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(n(e)+" is not iterable")}return b.prototype=x,i(k,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:b,configurable:!0}),b.displayName=l(x,f,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,l(t,f,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},O(S.prototype),l(S.prototype,s,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(k),l(k,f,"Generator"),l(k,c,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=o.call(a,"catchLoc"),s=o.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function s(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function f(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){s(i,n,o,a,c,"next",t)}function c(t){s(i,n,o,a,c,"throw",t)}a(void 0)}))}}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,h(n.key),n)}}function h(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,"string");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:String(e)}r.d(e,{Z:()=>p});const p=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.productions={},this.templates={},this.stories={},this.rundownsList={}}var e,r,n,i,a,s,h,p,y,d,v,m,g,w,b,x,E,L,_,k,O,S,j;return e=t,r=[{key:"initializeRundown",value:(j=f(u().mark((function t(e,r,n){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.stories[e]={},this.rundownsList[e]={},this.rundownsList[e]={uid:r,production:n};case 3:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return j.apply(this,arguments)})},{key:"setProductions",value:(S=f(u().mark((function t(e){var r,n,o,i;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(this.productions={},r=0;r<e.length;r++)n=c({},e[r]),o=n.name,i=n.uid,this.productions[o]=i;case 2:case"end":return t.stop()}}),t,this)}))),function(t){return S.apply(this,arguments)})},{key:"setTemplates",value:(O=f(u().mark((function t(e){var r=this;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.templates={},e.forEach((function(t){r.templates[t.name]={uid:t.uid,production:t.production,icon:t.icon}}));case 2:case"end":return t.stop()}}),t,this)}))),function(t){return O.apply(this,arguments)})},{key:"getProductions",value:(k=f(u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.productions);case 1:case"end":return t.stop()}}),t,this)}))),function(){return k.apply(this,arguments)})},{key:"getProductionsArr",value:(_=f(u().mark((function t(){var e,r,n,i,a,c;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e=[],r=0,n=Object.entries(this.productions);r<n.length;r++)i=o(n[r],2),a=i[0],c=i[1],e.push({name:a,uid:c});return t.abrupt("return",e);case 3:case"end":return t.stop()}}),t,this)}))),function(){return _.apply(this,arguments)})},{key:"getTemplatesByProduction",value:(L=f(u().mark((function t(e){var r,n,i,a,c,s,f,l,h,p;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(r=[],n=0,i=Object.entries(this.templates);n<i.length;n++)a=o(i[n],2),c=a[0],(s=a[1]).production===e&&(f=s.uid,l=s.production,h=s.icon,p={uid:f,production:l,icon:h,name:c},r.push(p));return t.abrupt("return",r);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return L.apply(this,arguments)})},{key:"getStory",value:(E=f(u().mark((function t(e,r){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isStoryExists(e,r)){t.next=2;break}return t.abrupt("return",this.stories[e][r]);case 2:case"end":return t.stop()}}),t,this)}))),function(t,e){return E.apply(this,arguments)})},{key:"getStoryUid",value:(x=f(u().mark((function t(e,r){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isStoryExists(e,r)){t.next=2;break}return t.abrupt("return",this.stories[e][r].uid);case 2:case"end":return t.stop()}}),t,this)}))),function(t,e){return x.apply(this,arguments)})},{key:"isStoryExists",value:(b=f(u().mark((function t(e,r){var n;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=!!this.stories[e]&&!!this.stories[e][r],t.abrupt("return",n);case 2:case"end":return t.stop()}}),t,this)}))),function(t,e){return b.apply(this,arguments)})},{key:"saveStory",value:(w=f(u().mark((function t(e,r,n){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.stories[e][r.identifier]={storyName:r.storyName,locator:r.locator,flags:r.flags,attachments:r.attachments,ord:n,uid:r.uid,enabled:r.enabled};case 1:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return w.apply(this,arguments)})},{key:"reorderStory",value:(g=f(u().mark((function t(e,r,n){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.stories[e][r.identifier].locator=r.locator,this.stories[e][r.identifier].ord=n;case 2:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return g.apply(this,arguments)})},{key:"modifyStory",value:(m=f(u().mark((function t(e,r){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.stories[e][r.identifier].storyName=r.storyName,this.stories[e][r.identifier].locator=r.locator,this.stories[e][r.identifier].flags=r.flags,this.stories[e][r.identifier].attachments=r.attachments;case 4:case"end":return t.stop()}}),t,this)}))),function(t,e){return m.apply(this,arguments)})},{key:"deleteStory",value:(v=f(u().mark((function t(e,r){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:delete this.stories[e][r];case 1:case"end":return t.stop()}}),t,this)}))),function(t,e){return v.apply(this,arguments)})},{key:"hasAttachments",value:(d=f(u().mark((function t(e,r){var n;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.stories[e]||!this.stories[e][r]){t.next=5;break}if(n=this.stories[e][r].attachments,0!==Object.keys(n).length){t.next=4;break}return t.abrupt("return",!1);case 4:return t.abrupt("return",!0);case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return d.apply(this,arguments)})},{key:"getRundownsArr",value:(y=f(u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object.keys(this.rundownsList));case 1:case"end":return t.stop()}}),t,this)}))),function(){return y.apply(this,arguments)})},{key:"getRundownUid",value:(p=f(u().mark((function t(e){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.rundownsList[e].uid);case 1:case"end":return t.stop()}}),t,this)}))),function(t){return p.apply(this,arguments)})},{key:"getRundown",value:(h=f(u().mark((function t(e){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.stories[e]);case 1:case"end":return t.stop()}}),t,this)}))),function(t){return h.apply(this,arguments)})},{key:"getRundownList",value:(s=f(u().mark((function t(e){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.rundownsList[e]);case 1:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"getRundownLength",value:(a=f(u().mark((function t(e){var r;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.stories[e],t.abrupt("return",r?Object.keys(r).length:0);case 2:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"getRundownIdentifiersList",value:(i=f(u().mark((function t(e){var r;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.stories[e]){t.next=3;break}return t.abrupt("return",[]);case 3:return t.abrupt("return",Object.keys(r));case 4:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"getData",value:(n=f(u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.stories);case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})}],r&&l(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}())},133:(t,e,r)=>{r.a(t,(async(t,n)=>{try{r.d(e,{Z:()=>y});var o=r(208),i=r(316);function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function c(){c=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",f=i.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var i=e&&e.prototype instanceof w?e:w,a=Object.create(i.prototype),c=new C(n||[]);return o(a,"_invoke",{value:j(t,r,c)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var y="suspendedStart",d="suspendedYield",v="executing",m="completed",g={};function w(){}function b(){}function x(){}var E={};l(E,u,(function(){return this}));var L=Object.getPrototypeOf,_=L&&L(L(N([])));_&&_!==r&&n.call(_,u)&&(E=_);var k=x.prototype=w.prototype=Object.create(E);function O(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,c,u){var s=p(t[o],t,i);if("throw"!==s.type){var f=s.arg,l=f.value;return l&&"object"==a(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,c,u)}),(function(t){r("throw",t,c,u)})):e.resolve(l).then((function(t){f.value=t,c(f)}),(function(t){return r("throw",t,c,u)}))}u(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function j(e,r,n){var o=y;return function(i,a){if(o===v)throw new Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=P(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===y)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var s=p(e,r,n);if("normal"===s.type){if(o=n.done?m:d,s.arg===g)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=m,n.method="throw",n.arg=s.arg)}}}function P(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[u];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(a(e)+" is not iterable")}return b.prototype=x,o(k,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:b,configurable:!0}),b.displayName=l(x,f,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,l(t,f,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},O(S.prototype),l(S.prototype,s,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(k),l(k,f,"Generator"),l(k,u,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function u(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?u(Object(r),!0).forEach((function(e){var n,o,i,c;n=t,o=e,i=r[e],(o="symbol"==a(c=f(o,"string"))?c:String(c))in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function f(t,e){if("object"!=a(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function l(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function h(){return p.apply(this,arguments)}function p(){var t;return t=c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new o.Z(s({},i.Z.conn)));case 2:case"end":return t.stop()}}),t)})),p=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){l(i,n,o,a,c,"next",t)}function c(t){l(i,n,o,a,c,"throw",t)}a(void 0)}))},p.apply(this,arguments)}const y=await h();n()}catch(d){n(d)}}),1)},535:(t,e,r)=>{r.d(e,{Z:()=>u});var n=r(147),o=r(17);function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,c(n.key),n)}}function c(t){var e=function(t,e){if("object"!=i(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==i(e)?e:String(e)}const u=new(function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.map={},this.unlinked={},this.cacheFilePath=o.join(o.resolve(),"src","1-dal","unlinkedItemsCache.json"),this.loadUnlinkedFromCache(),setInterval((function(){return e.updateCacheFile()}),6e5)}var e,r;return e=t,(r=[{key:"loadUnlinkedFromCache",value:function(){try{var t=n.readFileSync(this.cacheFilePath,"utf8");this.unlinked=JSON.parse(t)}catch(t){console.error("Error reading from cache file:",t),this.unlinked={}}}},{key:"updateCacheFile",value:function(){try{var t=JSON.stringify(this.unlinked);n.writeFileSync(this.cacheFilePath,t,"utf8")}catch(t){console.error("Error writing to cache file:",t)}}},{key:"add",value:function(t){this.map[t]?this.map[t]+=1:this.map[t]=1,delete this.unlinked[t]}},{key:"remove",value:function(t){this.map[t]&&(this.map[t]-=1,0===this.map[t]&&delete this.map[t])}},{key:"isUsed",value:function(t){return this.map[t]>0}},{key:"get",value:function(){return this.unlinked}},{key:"addUnlinked",value:function(t){this.unlinked[t]=""}}])&&a(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}())},380:(t,e,r)=>{r.d(e,{Z:()=>h});var n=r(860),o=r(119),i=r(153),a=r(535);function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function u(){u=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",f=i.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var i=e&&e.prototype instanceof w?e:w,a=Object.create(i.prototype),c=new C(n||[]);return o(a,"_invoke",{value:j(t,r,c)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var y="suspendedStart",d="suspendedYield",v="executing",m="completed",g={};function w(){}function b(){}function x(){}var E={};l(E,a,(function(){return this}));var L=Object.getPrototypeOf,_=L&&L(L(N([])));_&&_!==r&&n.call(_,a)&&(E=_);var k=x.prototype=w.prototype=Object.create(E);function O(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,u){var s=p(t[o],t,i);if("throw"!==s.type){var f=s.arg,l=f.value;return l&&"object"==c(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function j(e,r,n){var o=y;return function(i,a){if(o===v)throw new Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=P(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===y)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var s=p(e,r,n);if("normal"===s.type){if(o=n.done?m:d,s.arg===g)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=m,n.method="throw",n.arg=s.arg)}}}function P(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(c(e)+" is not iterable")}return b.prototype=x,o(k,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:b,configurable:!0}),b.displayName=l(x,f,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,l(t,f,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},O(S.prototype),l(S.prototype,s,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(k),l(k,f,"Generator"),l(k,a,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function s(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function f(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){s(i,n,o,a,c,"next",t)}function c(t){s(i,n,o,a,c,"throw",t)}a(void 0)}))}}var l=n.Router();l.get("/productions",function(){var t=f(u().mark((function t(e,r){var n;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.Z.getProductionsArr();case 2:n=t.sent,r.json(n);case 4:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()),l.get("/templates/:uid",function(){var t=f(u().mark((function t(e,r){var n,o;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.params.uid,t.next=3,i.Z.getTemplatesByProduction(n);case 3:o=t.sent,r.json(o);case 5:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()),l.get("/get-item-data/:uid",function(){var t=f(u().mark((function t(e,r){var n,i;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.params.uid,t.next=3,o.Z.getItemData(n);case 3:i=t.sent,r.json(i);case 5:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()),l.post("/set-item",function(){var t=f(u().mark((function t(e,r){var n,i;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=e.body,t.next=4,o.Z.storeNewItem(n);case 4:i=t.sent,r.json(i),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("Error processing JSON data:",t.t0),r.status(400).json("Error processing JSON data");case 12:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e,r){return t.apply(this,arguments)}}()),l.post("/update-item",function(){var t=f(u().mark((function t(e,r){var n;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=e.body,t.next=4,o.Z.updateItemFromFront(n);case 4:r.json(""),t.next=11;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("Error processing JSON data:",t.t0),r.status(400).json("Error processing JSON data");case 11:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e,r){return t.apply(this,arguments)}}()),l.get("/getdata",function(){var t=f(u().mark((function t(e,r){var n;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.Z.getData();case 2:n=t.sent,a.Z.get(),r.json(n);case 5:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}());const h=l},811:(t,e,r)=>{r.a(t,(async(t,n)=>{try{r.d(e,{Z:()=>I});var o=r(133),i=r(316),a=r(238),c=r(119),u=r(153),s=r(408),f=t([o]);function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function h(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=p(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function p(t,e){if(t){if("string"==typeof t)return y(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(t,e):void 0}}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function d(){d=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof w?e:w,a=Object.create(i.prototype),c=new C(n||[]);return o(a,"_invoke",{value:j(t,r,c)}),a}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var p="suspendedStart",y="suspendedYield",v="executing",m="completed",g={};function w(){}function b(){}function x(){}var E={};s(E,a,(function(){return this}));var L=Object.getPrototypeOf,_=L&&L(L(N([])));_&&_!==r&&n.call(_,a)&&(E=_);var k=x.prototype=w.prototype=Object.create(E);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var u=h(t[o],t,i);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==l(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(f).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function j(e,r,n){var o=p;return function(i,a){if(o===v)throw new Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=P(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var s=h(e,r,n);if("normal"===s.type){if(o=n.done?m:y,s.arg===g)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=m,n.method="throw",n.arg=s.arg)}}}function P(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=h(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(l(e)+" is not iterable")}return b.prototype=x,o(k,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:b,configurable:!0}),b.displayName=s(x,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,s(t,u,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},O(S.prototype),s(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(f(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(k),s(k,u,"Generator"),s(k,a,(function(){return this})),s(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function v(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function m(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){v(i,n,o,a,c,"next",t)}function c(t){v(i,n,o,a,c,"throw",t)}a(void 0)}))}}function g(){return w.apply(this,arguments)}function w(){return(w=m(d().mark((function t(){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Starting Inews-connect 1.6.5 ..."),t.next=3,c.Z.initialize();case 3:return t.next=5,b();case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function b(){return x.apply(this,arguments)}function x(){return(x=m(d().mark((function t(){var e,r,n,o;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.Z.getRundownsArr();case 2:e=t.sent,r=h(e),t.prev=4,r.s();case 6:if((n=r.n()).done){t.next=12;break}return o=n.value,t.next=10,E(o);case 10:t.next=6;break;case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(4),r.e(t.t0);case 17:return t.prev=17,r.f(),t.finish(17);case 20:setTimeout(b,i.Z.pullInterval);case 21:case"end":return t.stop()}}),t,null,[[4,14,17,20]])})))).apply(this,arguments)}function E(t){return L.apply(this,arguments)}function L(){return L=m(d().mark((function t(e){var r,n;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,o.Z.list(e);case 3:return r=t.sent,n=r.filter((function(t){return"STORY"===t.fileType})).map(function(){var t=m(d().mark((function t(r,n){var o,i,s,f,l;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,u.Z.isStoryExists(e,r.identifier);case 3:if(o=t.sent,r.storyName=(0,a.Z)(r.storyName),o){t.next=19;break}return t.next=8,j(e,r.fileName);case 8:return i=t.sent,r.attachments=i,T(i)?r.enabled=0:r.enabled=1,t.next=13,c.Z.addDbStory(e,r,n);case 13:return s=t.sent,r.uid=s,t.next=17,u.Z.saveStory(e,r,n);case 17:t.next=39;break;case 19:return t.next=21,_(e,r,n);case 21:if("reorder"!==(f=t.sent)){t.next=29;break}return t.next=25,c.Z.reorderDbStory(e,r,n);case 25:return t.next=27,u.Z.reorderStory(e,r,n);case 27:t.next=39;break;case 29:if("modify"!==f){t.next=39;break}return t.next=32,j(e,r.fileName);case 32:return T(l=t.sent)?r.enabled=0:r.enabled=1,r.attachments=l,t.next=37,c.Z.modifyDbStory(e,r);case 37:return t.next=39,u.Z.modifyStory(e,r);case 39:t.next=44;break;case 41:t.prev=41,t.t0=t.catch(0),console.error("ERROR at Index ".concat(n,":"),t.t0);case 44:case"end":return t.stop()}}),t,null,[[0,41]])})));return function(e,r){return t.apply(this,arguments)}}()),t.next=7,Promise.all(n);case 7:return t.t0=r.length,t.next=10,u.Z.getRundownLength(e);case 10:if(t.t1=t.sent,!(t.t0<t.t1)){t.next=13;break}O(e,r);case 13:t.next=18;break;case 15:t.prev=15,t.t2=t.catch(0),console.error("Error fetching and processing stories:",t.t2);case 18:case"end":return t.stop()}}),t,null,[[0,15]])}))),L.apply(this,arguments)}function _(t,e,r){return k.apply(this,arguments)}function k(){return(k=m(d().mark((function t(e,r,n){var o;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.Z.getStory(e,r.identifier);case 2:if(o=t.sent,n==o.ord){t.next=5;break}return t.abrupt("return","reorder");case 5:if(r.locator==o.locator){t.next=8;break}return t.abrupt("return","modify");case 8:return t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function O(t,e){return S.apply(this,arguments)}function S(){return S=m(d().mark((function t(e,r){var n,o,i,a,s;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={},t.next=3,u.Z.getRundownIdentifiersList(e);case 3:o=t.sent,i=h(r);try{for(i.s();!(a=i.n()).done;)s=a.value,n[s.identifier]=1}catch(t){i.e(t)}finally{i.f()}o.filter((function(t){return!n.hasOwnProperty(t)})).forEach(function(){var t=m(d().mark((function t(r){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.Z.deleteStory(e,r);case 2:return t.next=4,u.Z.deleteStory(e,r);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 8:case"end":return t.stop()}}),t)}))),S.apply(this,arguments)}function j(t,e){return P.apply(this,arguments)}function P(){return(P=m(d().mark((function t(e,r){var n,i;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.Z.story(e,r),t.next=3,n;case 3:return i=t.sent,t.abrupt("return",s.Z.parseAttachments(i.attachments));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function T(t){return 0===Object.keys(t).length}(o=(f.then?(await f)():f)[0]).Z.on("connections",(function(t){console.log(t+" FTP connections active")}));const I={startMainProcess:g};n()}catch(C){n(C)}}))},119:(t,e,r)=>{r.d(e,{Z:()=>Q});var n=r(316);const o=require("mssql");function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function a(){a=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",s=c.asyncIterator||"@@asyncIterator",f=c.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var i=e&&e.prototype instanceof w?e:w,a=Object.create(i.prototype),c=new C(n||[]);return o(a,"_invoke",{value:j(t,r,c)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var y="suspendedStart",d="suspendedYield",v="executing",m="completed",g={};function w(){}function b(){}function x(){}var E={};l(E,u,(function(){return this}));var L=Object.getPrototypeOf,_=L&&L(L(N([])));_&&_!==r&&n.call(_,u)&&(E=_);var k=x.prototype=w.prototype=Object.create(E);function O(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,a,c,u){var s=p(t[o],t,a);if("throw"!==s.type){var f=s.arg,l=f.value;return l&&"object"==i(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,c,u)}),(function(t){r("throw",t,c,u)})):e.resolve(l).then((function(t){f.value=t,c(f)}),(function(t){return r("throw",t,c,u)}))}u(s.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function j(e,r,n){var o=y;return function(i,a){if(o===v)throw new Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=P(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===y)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var s=p(e,r,n);if("normal"===s.type){if(o=n.done?m:d,s.arg===g)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=m,n.method="throw",n.arg=s.arg)}}}function P(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[u];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(i(e)+" is not iterable")}return b.prototype=x,o(k,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:b,configurable:!0}),b.displayName=l(x,f,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,l(t,f,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},O(S.prototype),l(S.prototype,s,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(k),l(k,f,"Generator"),l(k,u,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function c(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}var u={user:n.Z.sqlServerUser,password:n.Z.sqlServerPassword,server:n.Z.sqlServerHost,database:n.Z.sqlServerDatabase,options:{encrypt:!1,trustServerCertificate:!0}},s=new o.ConnectionPool(u).connect().then((function(t){return console.log("Connected to SQL Server"),t})).catch((function(t){throw console.error("Error connecting to SQL Server:",t),t}));function f(){var t;return t=a().mark((function t(e,r){var n,o,i,c,u;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,s;case 3:if(n=t.sent,!r){t.next=13;break}for(i in o=n.request(),r)r.hasOwnProperty(i)&&o.input(i,r[i]);return t.next=9,o.query(e);case 9:return c=t.sent,t.abrupt("return",c);case 13:return t.next=15,n.request().query(e);case 15:return u=t.sent,t.abrupt("return",u.recordset);case 17:t.next=23;break;case 19:throw t.prev=19,t.t0=t.catch(0),console.error("Error executing query:",t.t0),t.t0;case 23:case"end":return t.stop()}}),t,null,[[0,19]])})),f=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){c(i,n,o,a,u,"next",t)}function u(t){c(i,n,o,a,u,"throw",t)}a(void 0)}))},f.apply(this,arguments)}const l={execute:function(t,e){return f.apply(this,arguments)}};var h=r(147),p=r(17);const y=require("url"),d=require("jsdom");function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function m(){m=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof w?e:w,a=Object.create(i.prototype),c=new C(n||[]);return o(a,"_invoke",{value:j(t,r,c)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var h="suspendedStart",p="suspendedYield",y="executing",d="completed",g={};function w(){}function b(){}function x(){}var E={};s(E,a,(function(){return this}));var L=Object.getPrototypeOf,_=L&&L(L(N([])));_&&_!==r&&n.call(_,a)&&(E=_);var k=x.prototype=w.prototype=Object.create(E);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var u=l(t[o],t,i);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==v(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(f).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function j(e,r,n){var o=h;return function(i,a){if(o===y)throw new Error("Generator is already running");if(o===d){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=P(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var s=l(e,r,n);if("normal"===s.type){if(o=n.done?d:p,s.arg===g)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=d,n.method="throw",n.arg=s.arg)}}}function P(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=l(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(v(e)+" is not iterable")}return b.prototype=x,o(k,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:b,configurable:!0}),b.displayName=s(x,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,s(t,u,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},O(S.prototype),s(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(f(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(k),s(k,u,"Generator"),s(k,a,(function(){return this})),s(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function g(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return w(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?w(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function b(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}var x=(0,y.fileURLToPath)("file:///C:/Users/user/Desktop/Alex/Github/inews-connect/src/utilities/file-processor.js"),E=(0,p.dirname)(x);function L(){var t;return t=m().mark((function t(e){var r,n,o,i,a,c,u,s,f,l;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=p.resolve(E,"../../plugin/templates"),t.prev=1,t.next=4,h.promises.access(r);case 4:t.next=10;break;case 6:return t.prev=6,t.t0=t.catch(1),t.next=10,h.promises.mkdir(r);case 10:n=g(e),t.prev=11,n.s();case 13:if((o=n.n()).done){t.next=24;break}return i=o.value,a=i.uid,c=i.source,u=i.name,s=i.production,f=_(c,a,s),l=p.join(r,"".concat(a,".html")),t.next=20,h.promises.writeFile(l,f,"utf-8");case 20:delete i.source,console.log("Loaded ".concat(u," template"));case 22:t.next=13;break;case 24:t.next=29;break;case 26:t.prev=26,t.t1=t.catch(11),n.e(t.t1);case 29:return t.prev=29,n.f(),t.finish(29);case 32:return t.abrupt("return",e);case 33:case"end":return t.stop()}}),t,null,[[1,6],[11,26,29,32]])})),L=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){b(i,n,o,a,c,"next",t)}function c(t){b(i,n,o,a,c,"throw",t)}a(void 0)}))},L.apply(this,arguments)}function _(t,e,r){var n=new d.JSDOM(t),o=n.window.document,i=o.createElement("script");i.src="../assets/iframe.js";var a=o.createElement("link");a.rel="stylesheet",a.href="../assets/iframe.css";var c=function(t){var e=t.createElement("button");e.textContent="Back",e.id="navigateBack",e.classList.add("pluginPanelBtn");var r=t.createElement("button");r.textContent="Save",r.id="save",r.classList.add("pluginPanelBtn");var n=t.createElement("button");n.textContent="Drag",n.id="drag",n.draggable=!0,n.classList.add("pluginPanelBtn");var o=t.createElement("div");return o.id="pluginPanel",o.classList.add("pluginPanel"),o.appendChild(e),o.appendChild(r),o.appendChild(n),o}(o),u=o.querySelector(".toolbox-title");return u?u.appendChild(c):o.body.appendChild(c),o.body.appendChild(i),o.head.appendChild(a),o.body.setAttribute("data-template",e),o.body.setAttribute("data-production",r),n.serialize()}const k=function(t){return L.apply(this,arguments)};var O=r(153),S=r(535);function j(t){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(t)}function P(){P=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new C(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var h="suspendedStart",p="suspendedYield",y="executing",d="completed",v={};function m(){}function g(){}function w(){}var b={};s(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function _(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=l(t[o],t,i);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==j(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(f).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===y)throw new Error("Generator is already running");if(o===d){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=S(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var s=l(e,r,n);if("normal"===s.type){if(o=n.done?d:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=d,n.method="throw",n.arg=s.arg)}}}function S(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,S(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=l(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(j(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=s(w,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},_(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(f(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function T(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function I(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function C(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){I(i,n,o,a,c,"next",t)}function c(t){I(i,n,o,a,c,"throw",t)}a(void 0)}))}}function N(){return N=C(P().mark((function t(e,r){var n,o,i,a,c,u,s,f,l,h,p,y;return P().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O.Z.getStory(e,r.identifier);case 2:return n=t.sent,o=n.uid,t.next=6,O.Z.getRundownUid(e);case 6:i=t.sent,a=n.attachments,c=r.attachments,u=Object.keys(c),s=Object.keys(a),f=0,l=Object.entries(c);case 12:if(!(f<l.length)){t.next=34;break}if(d=l[f],v=2,h=function(t){if(Array.isArray(t))return t}(d)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(d,v)||function(t,e){if(t){if("string"==typeof t)return T(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?T(t,e):void 0}}(d,v)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),p=h[0],y=h[1],s.includes(p)){t.next=21;break}return S.Z.add(p),t.next=18,Q.updateItem(e,{itemId:p,rundownId:i,storyId:o,ord:y.ord});case 18:console.log("New item registered in ".concat(e,", story ").concat(r.storyName)),t.next=31;break;case 21:if(y.ord===a[p].ord){t.next=27;break}return t.next=24,Q.updateItemOrd(e,{itemId:p,rundownId:i,storyId:o,ord:y.ord});case 24:console.log("Item reordered in ".concat(e,", story ").concat(r.storyName)),t.next=31;break;case 27:if(y.itemSlug===a[p].itemSlug){t.next=31;break}return t.next=30,Q.updateItemSlug(e,{itemId:p,rundownId:i,storyId:o,itemSlug:y.itemSlug});case 30:console.log("Item ".concat(y.itemSlug," modified in ").concat(e,", story ").concat(r.storyName));case 31:f++,t.next=12;break;case 34:s.length>u.length&&s.forEach(function(){var t=C(P().mark((function t(r){return P().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u.includes(r)){t.next=3;break}return t.next=3,Q.deleteItem(e,{itemId:r,rundownId:i,storyId:o});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 35:case"end":return t.stop()}var d,v}),t)}))),N.apply(this,arguments)}const A={compareItems:function(t,e){return N.apply(this,arguments)}};function F(t){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F(t)}function G(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=D(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function R(){R=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new T(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var h="suspendedStart",p="suspendedYield",y="executing",d="completed",v={};function m(){}function g(){}function w(){}var b={};s(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function _(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=l(t[o],t,i);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==F(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(f).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===y)throw new Error("Generator is already running");if(o===d){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=S(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var s=l(e,r,n);if("normal"===s.type){if(o=n.done?d:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=d,n.method="throw",n.arg=s.arg)}}}function S(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,S(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=l(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(F(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=s(w,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},_(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(f(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function q(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,e)||D(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(t,e){if(t){if("string"==typeof t)return Z(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Z(t,e):void 0}}function Z(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function M(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function U(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){M(i,n,o,a,c,"next",t)}function c(t){M(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Y(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,z(n.key),n)}}function z(t){var e=function(t,e){if("object"!=F(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=F(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==F(e)?e:String(e)}var J=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,o,i,a,c,u,s,f,h,p,y,d,v,m,g,w,b,x,E;return e=t,r=[{key:"initialize",value:(E=U(R().mark((function t(){var e,r,o,i,a;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.deleteDBStories();case 3:e=0,r=Object.entries(n.Z.rundowns);case 4:if(!(e<r.length)){t.next=14;break}return o=q(r[e],1),i=o[0],t.next=8,this.addDbRundown(i);case 8:return a=t.sent,t.next=11,O.Z.initializeRundown(i,a,n.Z.rundowns[i].production);case 11:e++,t.next=4;break;case 14:return t.next=16,this.getAndStoreProductions();case 16:return t.next=18,this.getAndStoreTemplates();case 18:return t.next=20,this.hideUnwatchedRundowns();case 20:t.next=25;break;case 22:throw t.prev=22,t.t0=t.catch(0),t.t0;case 25:case"end":return t.stop()}}),t,this,[[0,22]])}))),function(){return E.apply(this,arguments)})},{key:"deleteDBStories",value:(x=U(R().mark((function t(){return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=4,l.execute("DELETE FROM ngn_inews_stories");case 4:console.log("ngn_inews_stories cleared...."),t.next=11;break;case 7:throw t.prev=7,t.t0=t.catch(0),console.error("Error deleting stories from SQL:",t.t0),t.t0;case 11:case"end":return t.stop()}}),t,null,[[0,7]])}))),function(){return x.apply(this,arguments)})},{key:"addDbRundown",value:(b=U(R().mark((function t(e){var r,o,i,a,c;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={name:e,lastUpdate:Math.floor(Date.now()/1e3),production:n.Z.rundowns[e].production,enabled:1,tag:""},o="\n            INSERT INTO ngn_inews_rundowns (name, lastupdate, production, enabled, tag)\n            OUTPUT INSERTED.uid\n            VALUES (@name, @lastUpdate, @production, @enabled, @tag);\n        ",i="\n            UPDATE ngn_inews_rundowns\n            SET lastupdate = @lastUpdate, \n                production = @production, \n                enabled = @enabled, \n                tag = @tag\n            WHERE name = @name;\n        ",t.prev=4,t.next=7,l.execute("\n            SELECT uid FROM ngn_inews_rundowns WHERE name = @name;\n        ",r);case 7:if(!((a=t.sent).recordset.length>0)){t.next=15;break}return t.next=11,l.execute(i,r);case 11:return console.log("Registering existing rundown to active watch: ".concat(e)),t.abrupt("return",a.recordset[0].uid);case 15:return t.next=17,l.execute(o,r);case 17:return c=t.sent,console.log("Registering new rundown to active watch: ".concat(e)),t.abrupt("return",c.recordset[0].uid);case 20:t.next=25;break;case 22:t.prev=22,t.t0=t.catch(4),console.error("Error registering rundown:",t.t0);case 25:case"end":return t.stop()}}),t,null,[[4,22]])}))),function(t){return b.apply(this,arguments)})},{key:"getAndStoreProductions",value:(w=U(R().mark((function t(){var e;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=4,l.execute("SELECT uid, name FROM ngn_productions");case 4:return e=t.sent,t.next=7,O.Z.setProductions(e);case 7:console.log("Loaded productions from SQL"),t.next=14;break;case 10:throw t.prev=10,t.t0=t.catch(0),console.error("Error loading productions from SQL:",t.t0),t.t0;case 14:case"end":return t.stop()}}),t,null,[[0,10]])}))),function(){return w.apply(this,arguments)})},{key:"getAndStoreTemplates",value:(g=U(R().mark((function t(){var e,r;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=4,l.execute("SELECT uid,source,name,production,icon FROM ngn_templates");case 4:return e=t.sent,t.next=7,k(e);case 7:return r=t.sent,t.next=10,O.Z.setTemplates(r);case 10:console.log("Loaded templates from SQL"),t.next=17;break;case 13:throw t.prev=13,t.t0=t.catch(0),console.error("Error loading templates from SQL:",t.t0),t.t0;case 17:case"end":return t.stop()}}),t,null,[[0,13]])}))),function(){return g.apply(this,arguments)})},{key:"hideUnwatchedRundowns",value:(m=U(R().mark((function t(){var e,r,n,o,i,a,c;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=4,l.execute("SELECT * FROM ngn_inews_rundowns");case 4:return e=t.sent,t.next=7,O.Z.getRundownsArr();case 7:r=t.sent,n=e.filter((function(t){return!r.includes(t.name)})).map((function(t){return t.uid})),o=G(n),t.prev=10,o.s();case 12:if((i=o.n()).done){t.next=20;break}return a=i.value,c={uid:a},t.next=18,l.execute("UPDATE ngn_inews_rundowns SET enabled=0 WHERE uid = @uid",c);case 18:t.next=12;break;case 20:t.next=25;break;case 22:t.prev=22,t.t0=t.catch(10),o.e(t.t0);case 25:return t.prev=25,o.f(),t.finish(25);case 28:console.log("Noticed ".concat(n.length," unwatched rundowns in db.")),t.next=35;break;case 31:throw t.prev=31,t.t1=t.catch(0),console.error("Error deleting stories from SQL:",t.t1),t.t1;case 35:case"end":return t.stop()}}),t,null,[[0,31],[10,22,25,28]])}))),function(){return m.apply(this,arguments)})},{key:"addDbStory",value:(v=U(R().mark((function t(e,r,n){var o,i,a,c;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O.Z.getRundownList(e);case 2:return o=t.sent,i={name:r.storyName,lastupdate:Math.floor(Date.now()/1e3),rundown:o.uid,production:o.production,ord:n,ordupdate:Math.floor(Date.now()/1e3),enabled:r.enabled,floating:r.flags.floated,tag:"",identifier:r.identifier,locator:r.locator},t.prev=5,t.next=8,l.execute("\n            INSERT INTO ngn_inews_stories (name, lastupdate, rundown, production, ord, ordupdate, enabled, floating, tag, identifier, locator)\n            OUTPUT inserted.uid\n            VALUES (@name, @lastupdate, @rundown, @production, @ord, @ordupdate, @enabled, @floating, @tag, @identifier, @locator);",i);case 8:return a=t.sent,c=a.recordset[0].uid,r.uid=c,Object.keys(r.attachments).length>0&&Object.entries(r.attachments).forEach(function(){var t=U(R().mark((function t(n){var i,a,c,u;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=q(n,2),a=i[0],c=i[1],u={rundownId:o.uid,storyId:r.uid,itemId:a,ord:c.ord},S.Z.add(a),t.next=5,J.updateItem(e,u);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.next=14,this.rundownLastUpdate(e);case 14:return console.log("Registering new story to ".concat(e,": ").concat(r.storyName)),t.abrupt("return",c);case 18:t.prev=18,t.t0=t.catch(5),console.error("Error executing query:",t.t0);case 21:case"end":return t.stop()}}),t,this,[[5,18]])}))),function(t,e,r){return v.apply(this,arguments)})},{key:"reorderDbStory",value:(d=U(R().mark((function t(e,r,n){var o;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o={ord:n,locator:r.locator,identifier:r.identifier,ordupdate:Math.floor(Date.now()/1e3)},t.prev=2,t.next=5,l.execute("\n            UPDATE ngn_inews_stories\n            SET ord = @ord, ordupdate = @ordupdate, locator = @locator\n            WHERE identifier = @identifier;\n        ",o);case 5:return t.next=7,this.rundownLastUpdate(e);case 7:console.log("Reorder story in ".concat(e,": ").concat(r.storyName)),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(2),console.error("Error executing query:",t.t0);case 13:case"end":return t.stop()}}),t,this,[[2,10]])}))),function(t,e,r){return d.apply(this,arguments)})},{key:"modifyDbStory",value:(y=U(R().mark((function t(e,r){var n;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={identifier:r.identifier,name:r.storyName,lastupdate:Math.floor(Date.now()/1e3),locator:r.locator,enabled:r.enabled,floating:r.flags.floated},t.prev=2,t.next=5,l.execute("\n            UPDATE ngn_inews_stories\n            SET name = @name, lastupdate = @lastupdate, locator = @locator, enabled = @enabled, floating = @floating\n            WHERE identifier = @identifier;\n        ",n);case 5:return t.next=7,this.rundownLastUpdate(e);case 7:if(t.t0=0!==Object.keys(r.attachments).length,t.t0){t.next=12;break}return t.next=11,O.Z.hasAttachments(e,r.identifier);case 11:t.t0=t.sent;case 12:if(!t.t0){t.next=15;break}return t.next=15,A.compareItems(e,r);case 15:console.log("Story modified in ".concat(e,": ").concat(r.storyName)),t.next=21;break;case 18:t.prev=18,t.t1=t.catch(2),console.error("Error executing query:",t.t1);case 21:case"end":return t.stop()}}),t,this,[[2,18]])}))),function(t,e){return y.apply(this,arguments)})},{key:"deleteStory",value:(p=U(R().mark((function t(e,r){var n,o,i,a,c;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,O.Z.getStory(e,r);case 3:return n=t.sent,o={identifier:r},t.next=8,l.execute("DELETE FROM ngn_inews_stories WHERE identifier = @identifier;",o);case 8:return t.next=10,this.rundownLastUpdate(e);case 10:if(!(Object.keys(n.attachments).length>0)){t.next=27;break}i=0,a=Object.keys(n.attachments);case 12:if(!(i<a.length)){t.next=27;break}return c=a[i],t.t0=this,t.t1=e,t.t2=c,t.next=19,O.Z.getRundownUid(e);case 19:return t.t3=t.sent,t.t4=n.uid,t.t5={itemId:t.t2,rundownId:t.t3,storyId:t.t4},t.next=24,t.t0.deleteItem.call(t.t0,t.t1,t.t5);case 24:i++,t.next=12;break;case 27:console.log("Story with identifier ".concat(r," deleted from ").concat(e)),t.next=33;break;case 30:t.prev=30,t.t6=t.catch(0),console.error("Error deleting ".concat(uid," story:"),t.t6);case 33:case"end":return t.stop()}}),t,this,[[0,30]])}))),function(t,e){return p.apply(this,arguments)})},{key:"updateItem",value:(h=U(R().mark((function t(e,r){var n;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={lastupdate:Math.floor(Date.now()/1e3),rundown:r.rundownId,story:r.storyId,ord:r.ord,ordupdate:Math.floor(Date.now()/1e3),uid:r.itemId},t.prev=2,t.next=5,l.execute("\n            UPDATE ngn_inews_items SET \n            lastupdate = @lastupdate, rundown = @rundown, story = @story, ord = @ord, ordupdate = @ordupdate\n            OUTPUT INSERTED.*\n            WHERE uid = @uid;",n);case 5:t.sent.rowsAffected[0]>0?console.log("Registered new GFX item "):console.log("WARNING! GFX ".concat(r.itemId," [").concat(r.ord,"] in ").concat(e,", story num ").concat(r.ord," doesn't exists in DB")),t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(2),console.error("Error on storing GFX item:",t.t0),t.abrupt("return",null);case 13:case"end":return t.stop()}}),t,null,[[2,9]])}))),function(t,e){return h.apply(this,arguments)})},{key:"updateItemOrd",value:(f=U(R().mark((function t(e,r){var n;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={ord:r.ord,ordupdate:Math.floor(Date.now()/1e3),uid:r.itemId},t.prev=2,t.next=5,l.execute("\n            UPDATE ngn_inews_items SET \n            ord = @ord, ordupdate = @ordupdate\n            OUTPUT INSERTED.*\n            WHERE uid = @uid;",n);case 5:t.sent.rowsAffected[0]>0&&console.log("Item Reordered event registered"),t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(2),console.error("Error on reordering GFX item:",t.t0),t.abrupt("return",null);case 13:case"end":return t.stop()}}),t,null,[[2,9]])}))),function(t,e){return f.apply(this,arguments)})},{key:"updateItemSlug",value:(s=U(R().mark((function t(e,r){var n;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={lastupdate:Math.floor(Date.now()/1e3),name:r.itemSlug,uid:r.itemId},t.prev=2,t.next=5,l.execute("\n            UPDATE ngn_inews_items SET \n            lastupdate = @lastupdate, name = @name\n            OUTPUT INSERTED.*\n            WHERE uid = @uid;",n);case 5:t.sent.rowsAffected[0]>0?console.log("Registered new GFX item "):console.log("WARNING! GFX ".concat(r.itemId," [").concat(r.ord,"] in ").concat(e,", story num ").concat(r.ord," doesn't exists in DB")),t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(2),console.error("Error on storing GFX item:",t.t0),t.abrupt("return",null);case 13:case"end":return t.stop()}}),t,null,[[2,9]])}))),function(t,e){return s.apply(this,arguments)})},{key:"deleteItem",value:(u=U(R().mark((function t(e,r){var n;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(S.Z.remove(r.itemId),S.Z.isUsed(r.itemId)){t.next=17;break}return n={uid:r.itemId},t.prev=4,t.next=7,l.execute("DELETE FROM ngn_inews_items WHERE uid = @uid;",n);case 7:t.sent.rowsAffected[0]>0?console.log("Delete GFX item ".concat(r.itemId," in ").concat(e,", story num ").concat(r.storyId)):console.log("WARNING! GFX ".concat(r.itemId," [").concat(r.ord,"] in ").concat(e,", story num ").concat(r.ord," doesn't exists in DB")),t.next=15;break;case 11:return t.prev=11,t.t0=t.catch(4),console.error("Error deleting GFX item:",t.t0),t.abrupt("return",null);case 15:t.next=18;break;case 17:console.log("[Skip deleting item] - Deleted item is in use in other stories.");case 18:case"end":return t.stop()}}),t,null,[[4,11]])}))),function(t,e){return u.apply(this,arguments)})},{key:"storeNewItem",value:(c=U(R().mark((function t(e){var r,n;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={name:e.name,lastupdate:Math.floor(Date.now()/1e3),production:e.productionId,rundown:"",story:"",ord:"",ordupdate:Math.floor(Date.now()/1e3),template:e.templateId,data:e.data,scripts:e.scripts,enabled:1,tag:""},t.prev=2,t.next=5,l.execute("\n            INSERT INTO ngn_inews_items (name, lastupdate, production, rundown, story, ord, ordupdate, template, data, scripts, enabled, tag)\n            OUTPUT INSERTED.uid\n            VALUES (@name, @lastupdate, @production, @rundown, @story, @ord, @ordupdate,@template, @data, @scripts, @enabled, @tag);",r);case 5:return n=t.sent,S.Z.addUnlinked(n.recordset[0].uid),t.abrupt("return",n.recordset[0].uid);case 10:return t.prev=10,t.t0=t.catch(2),console.error("Error on storing GFX item:",t.t0),t.abrupt("return",null);case 14:case"end":return t.stop()}}),t,null,[[2,10]])}))),function(t){return c.apply(this,arguments)})},{key:"getItemData",value:(a=U(R().mark((function t(e){var r,n;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={uid:e},t.prev=2,t.next=5,l.execute("\n            SELECT data FROM ngn_inews_items WHERE uid = @uid;\n        ",r);case 5:if(0!==(n=t.sent).rowsAffected[0]){t.next=8;break}return t.abrupt("return","N/A");case 8:return t.abrupt("return",n.recordset[0].data);case 11:return t.prev=11,t.t0=t.catch(2),console.error("Error on fetching item data:",t.t0),t.abrupt("return",null);case 15:case"end":return t.stop()}}),t,null,[[2,11]])}))),function(t){return a.apply(this,arguments)})},{key:"updateItemFromFront",value:(i=U(R().mark((function t(e){var r;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={name:e.name,lastupdate:Math.floor(Date.now()/1e3),production:e.productionId,template:e.templateId,data:e.data,scripts:e.scripts,enabled:1,tag:"",uid:e.gfxItem},t.prev=2,t.next=5,l.execute("\n            UPDATE ngn_inews_items\n            SET name = @name,\n                lastupdate = @lastupdate,\n                production = @production,\n                template = @template,\n                data = @data,\n                scripts = @scripts,\n                enabled = @enabled,\n                tag = @tag\n            WHERE uid = @uid;",r);case 5:console.log("Item ".concat(e.gfxItem," updated from the plugin")),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(2),console.error("Error on updating GFX item:",t.t0);case 11:case"end":return t.stop()}}),t,null,[[2,8]])}))),function(t){return i.apply(this,arguments)})},{key:"rundownLastUpdate",value:(o=U(R().mark((function t(e){var r,n;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O.Z.getRundownList(e);case 2:return r=t.sent,t.prev=3,n={uid:r.uid,lastupdate:Math.floor(Date.now()/1e3)},t.next=8,l.execute("\n                UPDATE ngn_inews_rundowns\n                SET lastupdate = @lastupdate\n                WHERE uid = @uid;\n            ",n);case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),console.error("Error rundownLastUpdate:",t.t0);case 13:case"end":return t.stop()}}),t,null,[[3,10]])}))),function(t){return o.apply(this,arguments)})}],r&&Y(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}());const Q=J},316:(t,e,r)=>{r.d(e,{Z:()=>o});var n=r(147);const o=JSON.parse((0,n.readFileSync)("./config.json","utf8"))},238:(t,e,r)=>{r.d(e,{Z:()=>o});const n=require("he"),o=function(t){if(null===t||""===t)return"";var e=t,r=Buffer.from(e,"latin1").toString("utf-8"),o=n.encode(r);return n.decode(o)}},639:(t,e,r)=>{r.d(e,{Z:()=>a});const n=require("os");function o(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return c=t.done,t},e:function(t){u=!0,a=t},f:function(){try{c||null==r.return||r.return()}finally{if(u)throw a}}}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}const a=function(){var t=n.networkInterfaces(),e="localhost";for(var r in t){var i,a=o(t[r]);try{for(a.s();!(i=a.n()).done;){var c=i.value;if("IPv4"===c.family&&!c.internal){e=c.address;break}}}catch(t){a.e(t)}finally{a.f()}}return e}},408:(t,e,r)=>{r.d(e,{Z:()=>o});const n=require("fast-xml-parser"),o={parseXmlString:function(t){var e=(new n.XMLParser).parse(t).AttachmentContent.mos.ncsItem.item;return{ord:e.itemID,itemId:e.gfxItem}},parseXmlForReorder:function(t){var e=(new n.XMLParser).parse(t).AttachmentContent.mos.ncsItem.item;return delete e.gfxItem,e},parseAttachments:function(t){var e={};for(var r in t)if(t[r].includes("<gfxProduction>")){var o,i=(new n.XMLParser).parse(t[r]);e[(o=i.AttachmentContent.mos.ncsItem?i.AttachmentContent.mos.ncsItem.item:i.AttachmentContent.mos).gfxItem]={gfxTemplate:o.gfxTemplate,gfxProduction:o.gfxProduction,itemSlug:o.itemSlug,ord:o.itemID}}return e}}}},i={};function a(t){var e=i[t];if(void 0!==e)return e.exports;var r=i[t]={exports:{}};return o[t](r,r.exports,a),r.exports}t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",r="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",n=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},a.a=(o,i,a)=>{var c;a&&((c=[]).d=-1);var u,s,f,l=new Set,h=o.exports,p=new Promise(((t,e)=>{f=e,s=t}));p[e]=h,p[t]=t=>(c&&t(c),l.forEach(t),p.catch((t=>{}))),o.exports=p,i((o=>{var i;u=(o=>o.map((o=>{if(null!==o&&"object"==typeof o){if(o[t])return o;if(o.then){var i=[];i.d=0,o.then((t=>{a[e]=t,n(i)}),(t=>{a[r]=t,n(i)}));var a={};return a[t]=t=>t(i),a}}var c={};return c[t]=t=>{},c[e]=o,c})))(o);var a=()=>u.map((t=>{if(t[r])throw t[r];return t[e]})),s=new Promise((e=>{(i=()=>e(a)).r=0;var r=t=>t!==c&&!l.has(t)&&(l.add(t),t&&!t.d&&(i.r++,t.push(i)));u.map((e=>e[t](r)))}));return i.r?s:a()}),(t=>(t?f(p[r]=t):s(h),n(c)))),c&&c.d<0&&(c.d=0)},a.d=(t,e)=>{for(var r in e)a.o(e,r)&&!a.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var c=a(450);module.exports=c})();